dist: xenial
language: python

python:
 - "2.7"
 - "3.5"
 - "3.6"
 - "3.7"

install:
  - pip install -r .requirements_dev.txt
  - pip install .

script: pytest -v --doctest-modules --cov-report=xml --cov=fast_carpenter tests/

after_success:
  - coverage combine
  - codecov

jobs:
  include:
    - stage: test
      script: flake8 --max-line-length=120 fast_carpenter tests
      name: flake8

deploy:
  provider: pypi
  user: fast-hep
  distributions: "sdist bdist_wheel"
  password:
    secure: "lIwMcEnW0s31HqRyJjwAp+GItILqquDSJJSGarLLsd9eW98byknaoRarJPf1u3IqmTYLXLaqWwsD133UimTJox5kgNgjV9FaDJOYYbBXzB8UCrWXXeAZMyAx1k+L/cQSy/gl7ns5/XkhuxpqpsqMlGaM3yAWbhmjFRi666S30Qga1mn2nRSWfaHGBTstKZ0dICg1/JV21bdP7Ll8A5dQmZfci/8EbdwyOtcrzNjzQZrj/VtTasXbZLi8arsGPoLfGRh5XWFTVq4Wf/hhTjjqkv6bs13NrXWtY62jK6bBXfQraI37sx/6rWoOXLRdneFUencBas7He5PnfOV3N5rCzMdGY06Jz9pqoCxIOWePtNpvOtqgYYNiZY8H8MeYPerFchMvd+xmm8nwyYrDR3JEM6a45ELR9/iUcm6AMr1Y38SMggNSD7theGmU0Dr4RrKj0vrFqTp62SkviwM4/ck7JgVu2PUuk+C5+T3NpGsh8tDYKRIxyGT4//zfa6ZpuA4QqlekxQGAQhbHvGR+JfAnN2Pf19KHokyfNUyI7HBiEqDA6sqCpmBgqBZkpbk9MU0vJiPlAgX6jYC1gRRXlRoLjoU+K2TNBDc7ZfFevyvEf9dEaVDe3AVfT+uEDPGEvtwXLHSDGU1q1P78IoRYr+qKg7S5T5PFpoFaeL+INY8FAOk="
  on:
    tags: true
    repo: FAST-HEP/fast-carpenter
    condition: "$TRAVIS_PYTHON_VERSION == 3.6 && $TRAVIS_TAG =~ ^v[0-9]+[.][0-9]+[.][0-9]+(-rc[0-9]+|[.]dev[0-9]+)?$"
