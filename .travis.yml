dist: xenial
language: python

python:
 - "2.7"
 - "3.5"
 - "3.6"
 - "3.7"

install:
  - pip install -r .requirements_dev.txt
  - pip install .

script: pytest -v --doctest-modules --cov-report=xml --cov=fast_carpenter tests/

after_success:
  - coverage combine
  - codecov

jobs:
  include:
    - stage: test
      script: flake8 --max-line-length=120 fast_carpenter tests
      name: flake8

deploy:
  provider: pypi
  user: fast-hep
  distributions: "sdist bdist_wheel"
  password:
    secure: "hzufLTP+uJKEca4nbl9oT4hZ/dxVTJfcBAQZvKVepOD3HdwIoKiBhb5IWID4Tvdl7Nulhyf2NeaGElBWHW8NvqxG+wm9qMX7Q+1EM3ffVvGJ7+LuhseeRodKSxCEXJLfHS/ZwTuwHqv3r1RBCn1utblu0O3/gGa75A7i4MtxlBow0jziEiGs+UzeIa85MhrMkLMwP4vWqaoiv+Y4/Z3RVoSeP4JJvcKv/NSmAoyloD1w8JHDeQ1AiEixYC5t38GWQtkDqj0gnX0gnZPsbJ86RBou2rUyUd3LLHKN0mJ1S1T9yEA9NjCIUHbUj+yV6zXsw+3/QRDh+G4a3TpPBKcbWJ93ozwS3oDGNyjZp8Ud2KhCzdRtuglVhZAFCIICZ+C/9IcdwE4enX0cXpr/KBlpvt9bJ0SonGsmzONnDraOGHsyp++LPxC8nIVc1ywX3bdRGss/vEXy8/R/PQXn3f94OTpwW87WLd6qmJRYMQ6ctBRKxS8jZy4bjPZ1mb2TujR8/IYmkb/Huw/0pPXUHyThcLcW0g/RJVLcg1Tuvcufg9umqgz23YKTIVxTH1AlFCo+JM1MTHm3dVhaJKDmh4sh0H3NxYkcsFO83bF/NymzK7X/LyITxO5jLvl2PiFVyyTnGgskvF8D0jUk67nYP5ILXYh/om+B9ejLC+NZR+Zmc24="
  on:
    tags: true
    repo: FAST-HEP/fast-carpenter
    condition: "$TRAVIS_PYTHON_VERSION == 3.6 && $TRAVIS_TAG =~ ^v[0-9]+[.][0-9]+[.][0-9]+(-rc[0-9]+|[.]dev[0-9]+)?$"
