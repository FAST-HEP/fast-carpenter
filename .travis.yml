dist: xenial
language: python

python:
 - "2.7"
 - "3.5"
 - "3.6"
 - "3.7"

install:
  - pip install -r .requirements_dev.txt
  - pip install .

script: pytest -v --doctest-modules --cov-report=xml --cov=fast_carpenter tests/

after_success:
  - coverage combine
  - codecov

jobs:
  include:
    - stage: test
      script: flake8 --max-line-length=120 fast_carpenter tests
      name: flake8

deploy:
  provider: pypi
  user: fast-hep
  distributions: "sdist bdist_wheel"
  password:
    secure: "ZjP1by1vWREThqnJtbiLbcAwiLD3vhUnxtkohfbGXa7OJHpPjqeS5nHXaQ9bnDTCrTFf+XchQpUpNJ8kqstQAIacImzkKoSihoMaMQcdy/Kki/NnMlFp/Nh+TVcmWpn6Ma9IM9zBTsxALhD6/uhkacUBBdYgU5j8HUOy25CPzSDnElg/Qz5EzYA5zPJp84GRK1b927OjFLyKHYQHKS1y1boNzGWIS21lg3cVRBh3oAS4kRbcLF45Ono6bQRgVD29zqVX7VGcIac/Sf/MSYClr4JFTOQAkhQs7PNb7pw6XL6GZWZ5F7eWSU9Ih+RscgtVk7C+zKWH4x7RwLvncd+YpRUc0cqKl/xTcjmNGMt4sbRe41cZzm5HgFOOkWciXOffSkwBK0uyX8F+Lt8VX8AIB3fVOAuF2icU55+67+HiQipRQUs7eOpEJruYDhUXmSgjQUwMX+ps1HjLdhACmKV/7jHia/Pkqud0DoPMEmOQRaMlZHa4jdXuYqrCJN6rirTIXZjHAPnAeRtb+3/ntPUVC87NVnbenl/J/Hqja4KbV6bADuqDkLCJtd/73RIDyEwejbW+pTIq0LhlwUaWKa0fHplOWHe9H837Ctko8Bm1nyGrq7MC6UIZUlxFOtApmB5WerCAnvL33f0VcZeaj+yU57K598a2KuSqbOj1VMK5bps="
  on:
    tags: true
    repo: FAST-HEP/fast-carpenter
    condition: "$TRAVIS_PYTHON_VERSION == 3.6 && $TRAVIS_TAG =~ ^v[0-9]+[.][0-9]+[.][0-9]+(-rc[0-9]+|[.]dev[0-9]+)?$"
