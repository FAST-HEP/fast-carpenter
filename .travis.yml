dist: xenial
language: python

python:
 - "2.7"
 - "3.5"
 - "3.6"
 - "3.7"

install:
  - pip install -r .requirements_dev.txt
  - pip install .

script: pytest -v --doctest-modules --cov-report=xml --cov=fast_carpenter tests/

after_success:
  - coverage combine
  - codecov

jobs:
  include:
    - stage: test
      script: flake8 --max-line-length=120 fast_carpenter tests
      name: flake8

deploy:
  provider: pypi
  user: fast-hep
  distributions: "sdist bdist_wheel"
  password:
    secure: "TtZTvWPMeSH9FlaTjKuj4xMaPXgmjQhX6dzD1uFvB3LGEmz1MVvXuCB/7kpJMKvAaFM8gNmQrhbfCHsWn8/doeW0Gp5OPUtCmYrTO6Dsj2cBGPQYqxyJDIxOkt9r7hNmRCE7gVGjxdF/Bjeowlk0TkYdo1zjAeCO9Qu6Ob24XvJky8PviiZSWBe7xGPNorq54OvXFfFUu+jCd3DHkYpF8xzPMIxoTo9/kreYT5Bcgp6pt+NJfVQ/APRfDpFzSZyPMFo4+zk0fo+H8M00b6w6KhJaL1zieowG1/0PKK9+EgSQschRteLIWupkxf/2YOpKnQRkqpf6RStaUbo4JzzG7D2DAvkZFzx8rCAmFB1th5AAcPnFw3tj7mnkckH7M9d1hcuXDkMv0nfL/aZoDRhbZ8rJf9NnFOjByME5qK9RKTECenWn7F6H3dogDw1SPcaGl7Ts8oEZQqeqbV5rExD/+5t4kdVN0SobgekDzK/yysaJHWgd0LdYiltKf2Mont9zOak5IulExFj/Sjdi1AWOIPdyGm20JA2IYJon22cRCbGJPcOppUjNq6FMH4xaIGcxS9JftzZQt83Ato9rRtWolGloxLiHUZtWVOOtYUcAXOqrjpTiw7ZWXKuUNh2zPORqTH65HAqA8XgGx2zRBcJN0uj9ZMr/q8VO8cLOVVVQt3s="
  on:
    tags: true
    repo: FAST-HEP/fast-carpenter
    condition: "$TRAVIS_PYTHON_VERSION == 3.6 && $TRAVIS_TAG =~ ^v[0-9]+[.][0-9]+[.][0-9]+(-rc[0-9]+|[.]dev[0-9]+)?$"
