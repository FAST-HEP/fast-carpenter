dist: xenial
language: python

python:
 - "2.7"
 - "3.5"
 - "3.6"
 - "3.7"

install:
  - pip install -r .requirements_dev.txt
  - pip install .

script: pytest -v --doctest-modules --cov-report=xml --cov=fast_carpenter tests/

after_success:
  - coverage combine
  - codecov

jobs:
  include:
    - stage: test
      script: flake8 --max-line-length=120 fast_carpenter tests
      name: flake8

deploy:
  provider: pypi
  user: fast-hep
  distributions: "sdist bdist_wheel"
  password:
    secure: "nhF1F64CCn2IKQUiryNXsL1jvQk9MpBwRDA0VhwCmceT7ZZtCBf4r9lzFA2ENnzC6TE0vCg+a7tY0WTYXVnYQ7u4rFmzh6SxyKFoeDjP8mO8+uVmWdFvsLhEOwwQlZRrZCkxKQR8JOIW2o9T+ClJFeU7PpwFw+Q+eZKjbdf5xvaxxhlcbQf9PFH8PqinKpqmCS046Zwj843MgHuwS73+r7iNdwsUUOD1brJW5c4CnKYvli2A7ojewtu9TjdkWgubb89vcZE7+UixOIFJ/Xp0KpMm4RVQRiP9V4+BV9a+5Z7FnhvnkUnFpVnJFRG3f+S2kRb8lBapzxcnDTMyzbIKSiUMth+b8rcuaOy96GA7l58FVEA7yuBL6KLvjUpD8wJeCB1X4Ius2SxKqLWXbI52wDvjAKtNlgTlobW2c6eGdLAKBW/8pM+V51Pc5/rpmRxVsODJ2Kef3YMF90ZrlGLHA1Je38R/GLu3BiA+LjQU5ajKi2dd1NWALDJIRvea+G1b6ei9sBA53V9OXVG3OI9ALqGQ/aSsdUZgLB7m0MCl8xerhMuT8wNSxWpTLXnSIFfDzWp5XDYrYutiKJSWG2HY+Lw8CwJRHTDTkaz0pSGCTTj0gamoSWSfYRk91yGZXlpR/mno0U+LV1Mk3BiaHpkD22myvCTm2PY6h+NKMhvcHNY="
  on:
    tags: true
    repo: FAST-HEP/fast-carpenter
    condition: "$TRAVIS_PYTHON_VERSION == 3.6 && $TRAVIS_TAG =~ ^v[0-9]+[.][0-9]+[.][0-9]+(-rc[0-9]+|[.]dev[0-9]+)?$"
